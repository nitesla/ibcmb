<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{corp-layout}">
<head>
    <link rel="stylesheet" type="text/css" th:href="@{~/customer/css/tabs.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{~/customer/css/bootstrap.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{~/customer/css/custom.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{~/customer/css/select.bootstrap.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{~/customer/plugins/datatables/css/jquery.dataTables.min.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{~/customer/plugins/datatables/css/dataTables.bootstrap.css}"/>

</head>

<style>
    .hstyle{
        width: 100%;
        text-align: center;
        border-bottom: 1px solid #000;
        line-height: 0.1em;
        margin: 10px 0 20px;
    }

    .hstyle span {
        background:#fff;
        padding:0 10px;
    }
    table.dataTable tbody > tr.selected{
        color: black;
        background-color: #d7bdb3;
    }
</style>
<body onload="javascript:var bread = [['Home', '/corporate/dashboard'],['Bulk transfer','/corporate/transfer/bulk'],['approve','']];currentBar('approve multiple');breadCrumb(bread)">

<div layout:fragment="content">
    <div class="col-md-5 col-sm-5 ">

        <select class="form-control full-width coronation-form-control hide-content-only" id="view">
            <option value="account">Overview</option>
        </select>
    </div>

    <div class="col-xs-12 " >
        <div class="no-pad-lef  no-mt no-bd  alert">
                <div class="row spacing">

                    <div class="col-xs-12 col-sm-6">
                    <div class="form-group ">
                        <p>Request Date: <span th:text="${bulkTransfer.tranDate}"></span></p>
                        <p>Source account: <span th:text="${bulkTransfer.customerAccountNumber}"></span></p>

                    </div>
                    </div>

                    <!--<div class="col-xs-12 col-sm-6" style="width:100%; height:250px; background-color: red">-->
                        <!--<label class="label label-success">Pie Chart</label>-->
                        <!--<div id="pie-chart"></div>-->
                    <!--</div>-->

                    <div class="col-xs-12 col-sm-6">
                        <div id="pie-chart" style="width:70%; height:150px; background-color: whitesmoke"></div>
                    </div>
                    <input type="hidden" class="form-control" th:value="${bulkTransfer.id}" th:field="*{bulkTransfer.id}" th:id="bk" id="bk" />


                    <div class="col-xs-12">
                    <ul class="nav nav-tabs ">

                            <li class="active">
                                <a href="#tab_authorizations" data-toggle="tab">
                                Authorizations </a>
                            </li>
                                <li>
                                    <a href="#tab_transummary" data-toggle="tab">
                                        Transaction Details </a>
                                </li>

                            </ul>
                            <div class="tab-content">

                                <div class="tab-pane active" id="tab_authorizations">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-bordered table-hover">
                                            <thead>
                                            <td>Role</td>
                                            <td>Authorizer</td>
                                            <td>Status</td>
                                            <td>Comments</td>
                                            <td>Entry Date</td>
                                            <td>Attribute</td>
                                            </thead>
                                            <tbody>



                                            <tr th:each="auth : ${authorizationMap.auths}" th:if="${authorizationMap.auths != null }">
                                                <td th:text="${auth.role.name+' '+auth.role.rank}"></td>
                                                <td  th:text="${auth.user.firstName+' '+auth.user.lastName}"></td>
                                                <td  th:text="${auth.status}"></td>
                                                <td th:text="${auth.comments}"></td>
                                                <td th:text="${#dates.format(auth.entryDate,'dd-MM-yyyy hh:mm a')}"></td>
                                                <td  th:if="${corpTransRule.anyCanAuthorize}">Optional</td>
                                                <td  th:unless="${corpTransRule.anyCanAuthorize}">Required</td>
                                            </tr>
                                            <tr th:each="trn : ${rolesNotAuth}">
                                                <td th:text="${trn.name + ' ' + trn.rank }"></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td  th:if="${corpTransRule.anyCanAuthorize}">Optional</td>
                                                <td  th:unless="${corpTransRule.anyCanAuthorize}">Required</td>
                                            </tr>
                                            </tbody>
                                        </table>

                                        <form th:action="@{/corporate/transfer/bulk/approve}" method="post">
                                            <!--<label class="control-label">Comments</label>-->
                                            <textarea th:if="${userCanAuthorize}" class="form-control"
                                                      th:field="${corpTransReqEntry.comments}" placeholder="Enter comments"></textarea>

                                            <div >
                                                <input type="text" th:if="${userCanAuthorize}" class="form-control"
                                                       name="token" placeholder="Enter token code"/>
                                            </div>
                                            <div>

                                                <input type="hidden" name="tranReqId" th:value="${corpTransRequest.id}"/>
                                            </div>
                                            <div>
                                                <button class="btn btn-link required-step" th:if="${userCanAuthorize}" type="submit">
                                                    Approve
                                                </button>
                                                <!--<button id="cancel" class="btn btn-link required-less" type="reset" >Back</button>-->
                                            </div>
                                        </form>

                                    </div>
                                </div>

                                <div class="tab-pane" id="tab_transummary">
                                    <div class="table-responsive">
                                        <table id="mytab" class="table table-striped table-bordered table-hover " >
                                            <thead>
                                            <th>Account Number</th>
                                            <th>Sort Code</th>
                                            <th>Beneficiary Name</th>
                                            <th>Amount (N)</th>
                                            <th>Narration</th>
                                            <th>Status</th>

                                            </thead>
                                            <tbody>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>


                                <div class="tab-pane" id="chart">


                                </div>
                            </div>

                    </div>

                </div>
        </div>
    </div>

</div>


<th:block layout:fragment="scripts">
    <script th:src="@{~/bank/vendors/sweetalert/sweetalert.min.js}"></script>
    <script th:src="@{~/bank/vendors/bootstrap-dialog/js/bootstrap-dialog.js}"></script>
    <script th:src="@{~/bank/js/jquery.spring-friendly.min.js}"></script>
    <script th:src="@{~/customer/js/raphael-min.js}"></script>
    <script th:src="@{~/customer/js/morris.min.js}"></script>



    <script th:inline="javascript">
        //<![CDATA[

        $(document).ready(function() {
            var id = document.getElementById("bk").value;
            var json_data = (function() {
                var json;
                $.ajax({
                    type:'GET',
                    url: "/corporate/transfer/" +id+ "/status",
                    async: false,
                    global: false,
                    success: function(data) {
                        json = data;
                    },
                    error:function(){
                        alert("Error loading chart");
                    }
                });
                return json;
            })();

            var sum = 0, value = json_data, i;
            for (i = 0; i < value.length; i++) {
                sum += value[i].value;
            }
            console.log(sum);

            Morris.Donut({
                element: "pie-chart",
                data:
                json_data
                ,
                formatter: function(y,data) {

                    return Math.round(y/(sum)*100) + "%";
                },
                colors: ['lightgreen', 'red', 'orange'],
            });




            var table = $('#mytab').DataTable({
                select:true,
                "lengthMenu" : [ [ 5, 10, 20],	[ 5, 10, 20 ] ],
                "pagingType" : "simple_numbers",
                "searching": false,
                "paging": true,
                "serverSide" : false,
                "ajax": "/corporate/transfer/" +id+ "/allcreditrequests",
                "dom": 'T<"clear">frtlp',
                "columns": [
                    { "data": "accountNumber" },
                    { "data": "sortCode" },
                    { "data": "accountName" },
                    { "data": "amount" },
                    { "data": "narration" },
                    { "data": "status" }
                ] });

        });

        //});

        /*]]>*/

    </script>

</th:block>

</body>
</html>