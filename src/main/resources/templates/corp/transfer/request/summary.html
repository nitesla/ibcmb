<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="corp_layout :: site-head">

</head>


<style>
    .hstyle {
        width: 100%;
        text-align: center;
        border-bottom: 1px solid #000;
        line-height: 0.1em;
        margin: 10px 0 20px;
    }

    .hstyle span {
        background: #fff;
        padding: 0 10px;
    }
</style>
<body>


<div class="container">
    <header th:replace="corp_layout ::corp-header">
    </header>

    <section class="content-wrapper">

        <div class="">

            <div class="row">
                <div class="col-md-4 col-sm-4">
                    <h5 class="page_header"> Transaction Summary</h5>

                    <select class="form-control invisible" name="beneficiaries">
                        <option value="Overveiw">Beneficiaries</option>
                    </select>
                </div>
                <p class="col-xs-12 invisible">
                    Fields marked <span style="color:red">*</span> are compulsory
                </p>
            </div>

            <div class="row">
                <div class="col-md-9 content-bg">
                    <div class="form-spacin col-md-7 col-sm-7">
                        <!--<h2>Transaction Details</h2>-->
                        <table class="''table table-responsive table-condensed">
                            <tr>

                                <th>From Account</th>
                                <td th:text="${corpTransRequest.customerAccountNumber}"></td>

                            </tr>
                            <tr>

                                <th>Beneficiary Account Name</th>
                                <td th:text="${corpTransRequest.beneficiaryAccountName}"></td>

                            </tr>
                            <tr>

                                <th>Beneficiary Account Number</th>
                                <td th:text="${corpTransRequest.beneficiaryAccountNumber}"></td>

                            </tr>
                            <tr>

                                <th>Beneficiary Bank</th>
                                <td th:text="${corpTransRequest.financialInstitution.institutionName}"></td>

                            </tr>
                            <tr>

                                <th>Amount</th>
                                <td th:text="${corpTransRequest.amount}"></td>

                            </tr>

                        </table>
                    </div>

                    <div class="col-md-4 col-sm-4 well">
                        Transfer Rule
                        <hr class="related-info"/>
                        <table class="table-condensed">
                            <tr>

                                <th>Lower Amount:</th>
                                <td th:text="${corpTransRule.currency+''+corpTransRule.lowerLimitAmount}"></td>

                            </tr>
                            <tr>

                                <th>Upper Amount:</th>
                                <td th:text="${corpTransRule.currency+''+corpTransRule.upperLimitAmount}"></td>

                            </tr>
                        </table>


                    </div>


                    <hr width="100%" size="1"/>
                    <h6 class="hstyle"><span>Authorizations</span></h6>
                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                        <td>Role</td>

                        <td>Author</td>
                        <td>Status</td>
                        <td>Comments</td>
                        <td>Entry Date</td>
                        <td>Attribute</td>
                        </thead>

                        <tbody>


                        <!--<tr th:each="trn : ${corpTransRule.roles}">-->
                        <!--<td th:text="${trn.name + ' ' + trn.rank }"></td>-->

                        <!--<span-->
                        <!--th:each="auth : ${authorizationMap.auths}" th:if="${authorizationMap.auths != null }">-->
                        <!--&lt;!&ndash;<span th:if="${auth.corporateRole.name} == ${trn.name}">&ndash;&gt;-->
                        <!--<td>-->
                        <!--<span th:if="${auth.role.id} == ${trn.id}" th:text="${auth.user.userName}"></span>-->
                        <!--&lt;!&ndash;<span th:unless="${auth.role.id} == ${trn.id}"></span>&ndash;&gt;-->
                        <!--</td>-->
                        <!--<td>-->
                        <!--<span th:if="${auth.role.id} == ${trn.id}" th:text="${auth.status}"></span>-->
                        <!--&lt;!&ndash;<span th:unless="${auth.role.id} == ${trn.id}"></span>&ndash;&gt;-->
                        <!--</td>-->
                        <!--<td>-->
                        <!--<span th:if="${auth.role.id} == ${trn.id}" th:text="${auth.comments}"></span>-->
                        <!--&lt;!&ndash;<span th:unless="${auth.role.id} == ${trn.id}"></span>&ndash;&gt;-->
                        <!--</td>-->
                        <!--<td>-->
                        <!--<span th:if="${auth.role.id} == ${trn.id}" th:text="${auth.entryDate}"></span>-->
                        <!--&lt;!&ndash;<span th:unless="${auth.role.id} == ${trn.id}"></span>&ndash;&gt;-->
                        <!--</td>-->


                        <!--</span>-->
                        <!--<span th:if="${corpTransRule.anyCanAuthorize == false}">-->
                        <!--<td>Required</td>-->
                        <!--</span>-->
                        <!--<span th:if="${corpTransRule.anyCanAuthorize == true}">-->
                        <!--<td>Optional</td>-->
                        <!--</span>-->
                        <!--</tr>-->




                        <tr th:each="auth : ${authorizationMap.auths}" th:if="${authorizationMap.auths != null }">
                            <td th:text="${auth.role.name+' '+auth.role.rank}"></td>
                            <td  th:text="${auth.user.firstName+' '+auth.user.lastName}"></td>
                            <td  th:text="${auth.status}"></td>
                            <td th:text="${auth.comments}"></td>
                            <td th:text="${auth.entryDate}"></td>
                            <td  th:if="${corpTransRule.anyCanAuthorize}">Optional</td>
                            <td  th:unless="${corpTransRule.anyCanAuthorize}">Required</td>
                        </tr>
                        <tr th:each="trn : ${rolesNotAuth}">
                            <td th:text="${trn.name + ' ' + trn.rank }"></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td  th:if="${corpTransRule.anyCanAuthorize}">Optional</td>
                            <td  th:unless="${corpTransRule.anyCanAuthorize}">Required</td>
                        </tr>
                        </tbody>
                    </table>

                    <form th:action="@{/corporate/transfer/authorize}" method="post">
                        <label class="control-label">Comments</label>
                        <textarea th:if="${userCanAuthorize}" class="form-control"
                                  th:field="${corpTransReqEntry.comments}"></textarea>
                        <div>
                            <input type="hidden" name="tranReqId" th:value="${corpTransRequest.id}"/>
                        </div>
                        <div>
                            <button class="btn btn-link required-step" th:if="${userCanAuthorize}" type="submit">
                                Approve
                            </button>
                            <a id="canc" class="btn btn-link less-required" th:href="@{/corporate/transfer/requests}">Back</a>
                        </div>
                    </form>

                </div>
                <div class="col-md-3 pull-right">
                    <div th:replace="corp_layout :: corp-sidebar">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CONTENT-WRAPPER SECTION END-->
    <footer th:replace="corp_layout ::corp-footer">
    </footer>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    $(document).ready(function () {
        var table = $('#requests').DataTable({
            select: true,
            responsive: true,
            "lengthMenu": [[5, 10, 20], [5, 10, 20]],
            "pagingType": "simple_numbers",
            "searching": false,
            "paging": true,
            "serverSide": true,
            rowId: 'id',
            "ajax": "/corporate/transfer/requests/all",
            "dom": 'T<"clear">frtlp',
            "columns": [
                {"data": "transferType"},
                {"data": "beneficiaryAccountName"},
                {"data": "financialInstitution.institutionName"},
                {"data": "amount"}
            ]
        });

        table.on('select', function () {
            if (table.rows({
                    selected: true
                }).indexes().length === 0) {
                $('.bt-select').attr("disabled", true);
            } else {
                $('.bt-select').removeAttr("disabled");
            }

        });

        table.on('deselect', function () {
            if (table.rows({
                    selected: true
                }).indexes().length === 0) {
                $('.bt-select').attr("disabled", true);
            } else {
                $('.bt-select').removeAttr("disabled");
            }
        });

    });

    $("a.bt-link-act").on("click", function (e) {
        e.preventDefault();
        var link = $(e.currentTarget);
        if ($(link).attr("disabled")) {
            return;
        }
        var dt = $('#requests').DataTable();
        var id = $(dt.row({
            selected: true
        }).node()).attr("id");
        var ooo = link.attr("href").replace("index", id);
        window.location.assign(ooo);

    });

    $("#delete-btn").on("click", function (e) {
        e.preventDefault();
        var link = $(e.currentTarget);
        if ($(link).attr("disabled")) {
            return;
        }
        var dt = $('#requests').DataTable();
        var id = $(dt.row({
            selected: true
        }).node()).attr("id");
        //window.location.href = link.attr("formaction") + '?id=' + id;
        //replace {id} with id
        var ooo = link.attr("href").replace("index", id);
        warnBeforeRedirect(ooo);

    });


    function warnBeforeRedirect(ooo) {
        swal({
            title: "Are you sure?",
            text: "Are you sure that you want to delete this code?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes, delete code!",
            closeOnConfirm: false
        }, function () {
            // Redirect the user
            window.location.assign(ooo);
        });
    }


    function goBack() {

        $("#canc").click(function () {

            location.href = "/corporate/transfer/requests";

        });
    }


    /*]]>*/
</script>

</body>
</html>