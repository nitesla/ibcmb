<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{ret-layout}">

<body onload="javascript:var bread = [['Home', '/retail/dashboard'],['service request', '']];currentBar('service request');breadCrumb(bread)">

<div layout:fragment="content">
    <div class="col-md-5 col-sm-5 ">

        <select class="form-control full-width coronation-form-control hide-content-only" id="view">
            <option value="account">Overview</option>
        </select>
    </div>

    <div class="col-xs-12" >
        <div class=" no-pad-lef no-mt alert no-bd">
           <div class="">
                  <div class="col-md-6 no-pad-left table-responsive">
                       <h5 class="sub_header" th:text="${requestConfig.requestName}"></h5>
                                        <form method="post" th:action="@{/retail/requests}" th:object="${requestDTO}" id="reqForm">
                                            <input class="form-control" type="hidden" id="requestName" name="requestName" th:value="${requestConfig.requestName}"/>
                                            <input type="hidden" name="serviceReqConfigId" th:value="${requestConfig.id}"/>
                                            <div th:each="field : ${requestConfig.formFields}">
                                                <div class="form-group">
                                                <label th:text="${field.fieldLabel}"></label>

                                                <p th:if="${field.fieldType} == 'TEXT'">
                                                    <input class="form-control" type="text" th:name="${field.fieldName}" required="required"/>
                                                    <span class='req-inner'></span>
                                                </p>

                                                <p th:if="${field.fieldType} == 'NUMBER'">
                                                    <input class="form-control" type="number" min="0" th:name="${field.fieldName}" required="required"/><span class='req-inner'></span>
                                                </p>

                                                <p th:if="${field.fieldType} == 'TEXTAREA'" required="required">
                                            <textarea class="form-control" th:name="${field.fieldName}">
                                            </textarea><span class='req-inner'></span>
                                                </p>

                                                <p th:if="${field.fieldType} == 'DATE'">
                                                    <input class="form-control" id="datepicker" type="text" th:name="${field.fieldName}" required="required"/><span class='req-inner'></span>
                                                </p>

                                                <p th:if="${field.fieldType} == 'CODE'">
                                                    <select class="form-control" th:name="${field.fieldName}" required="required">
                                                        <option th:each="code : ${codes}" th:value="${code.code}" th:text="${code.description}"></option>
                                                    </select><span class='req-inner'></span>
                                                </p>

                                                <p th:if="${field.fieldType} == 'FI'">
                                                    <select class="form-control" th:name="${field.fieldName}" required="required">
                                                        <option th:each="bank : ${banks}" th:value="${bank.institutionCode}" th:text="${bank.institutionName}"></option>
                                                    </select><span class='req-inner'></span>
                                                </p>

                                                <p th:if="${field.fieldType} == 'ACCT'">
                                                    <select class="form-control" th:name="${field.fieldName}" required="required">
                                                        <option th:each="acc : ${accts}" th:value="${acc.accountNumber}" th:text="${acc.accountNumber}"></option>
                                                    </select><span class='req-inner'></span>
                                                </p>
                                                <p th:if="${field.fieldType} == 'LIST'">
                                                    <select class="form-control" th:name="${field.fieldName}" required="required">
                                                        <option th:each="type : ${fixedList}" th:value="${type}" th:text="${type}"></option>
                                                    </select><span class='req-inner'></span>
                                                </p>
                                                </div>
                                            </div>

                                            <button type="submit" class="btn btn-link required-step">Submit</button>
                                        </form>

                    </div>

               <div class="col-md-5 col-sm-5 col-xs-12">
                   <div  class=" related-box">
                       <h3 class="related-bar">Related Information</h3>

                       <p style="padding-left: 2%" th:each="code: ${codes}">
                           <strong><span th:text="${code.description}"></span></strong><br/>
                           <span th:if="${code.extraInfo!=null}" th:text="${code.extraInfo}"></span><br/><br/>
                       </p>

                   </div>

               </div>
                               
            </div>
        </div>
    </div>

</div>


<th:block layout:fragment="scripts">

    <script>
        $(document).ready(function () {
            $('#datepicker').datepicker({
                autoclose: true,
                todayBtn: true,
                todayHighlight: true
            });
        });

    </script>


 <script>
            $('#reqForm').submit(function(event) {
                //        event.preventDefault();
                //        var formData = JSON.stringify($("#reqForm").serializeArray());
                var arrays = [];
                //        $('.form-group').each(function(index, element){
                //            var select = $(element).find('select');
                //            arrays.push({"name": select.prop('name'), "value": select.prop("value")});
                //        });
                //
                //        $('.form-group').each(function(index, element){
                //            var input = $(element).find('input');
                //            arrays.push({"name": input.prop('name'), "value": input.prop("value")});
                //        });

                //       var formData = $('#reqForm').serialize();
                //
                ////        alert(arrays);
                //


                //        alert(formData);


                var form = $('#reqForm').serializeArray();
                var formData =  JSON.stringify(form);
                $('#requestName').val(formData);
                $('#submitform').submit();



                //        var s = '';
                //        var data = {};
                //        for(s in form){
                //            data[form[s]['name']] = form[s]['value']
                //        }


                //            var formData = {
                //            requestName: $('#requestName').val(),
                //            body: data
                //        }

            });
        </script>
</th:block>

</body>
</html>